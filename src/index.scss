@use "sass:map";

// ========================
// 透明度配置
// ========================
$opacity-levels: (
  1: 0.5,
  2: 0.4,
  3: 0.3
) !default;

// ========================
// 基础过渡效果
// ========================
.protyle-wysiwyg {
  [data-node-id] {
    transition: opacity 0.7s ease;
  }

  // ========================
  // 焦点块样式
  // ========================
  .focus-block {
    opacity: 1 !important;
  }

  // ========================
  // 上游块（上方元素）
  // ========================
  // 距离1：直接相邻的上游块
  [data-node-id].p:has(+ .focus-block),
  [data-type="NodeHeading"]:has(+ .focus-block),
  .protyle-action:has(+ .focus-block),
  [data-type="NodeList"]:has(+ .focus-block) {
      opacity: map.get($opacity-levels, 1) !important;
  }

  // 距离2：间隔一个块的上游块
  [data-node-id].p:has(+ .blur-block + .focus-block),
  [data-type="NodeHeading"]:has(+ .blur-block + .focus-block),
  .protyle-action:has(+ .blur-block + .focus-block),
  [data-type="NodeList"]:has(+ .blur-block + .focus-block) {
      opacity: map.get($opacity-levels, 2) !important;
  }

  // 距离3：间隔两个块的上游块
  [data-node-id].p:has(+ .blur-block + .blur-block + .focus-block),
  [data-type="NodeHeading"]:has(+ .blur-block + .blur-block + .focus-block),
  .protyle-action:has(+ .blur-block + .blur-block + .focus-block),
  [data-type="NodeList"]:has(+ .blur-block + .blur-block + .focus-block) {
      opacity: map.get($opacity-levels, 3) !important;
  }


  // ========================
  // 下游块（下方元素）
  // ========================
  // 距离1：直接相邻的下游块
  .focus-block + .p,
  .focus-block + [data-type="NodeHeading"],
  .focus-block + .protyle-action,
  & > .focus-block + [data-type="NodeList"] {
      opacity: map.get($opacity-levels, 1) !important;
  }

  // 距离2：间隔一个块的下游块
  .focus-block + .blur-block + .p,
  .focus-block + .blur-block + [data-type="NodeHeading"],
  .focus-block + .blur-block + .protyle-action,
  .focus-block + .blur-block + [data-type="NodeList"] {
      opacity: map.get($opacity-levels, 2) !important;
  }

  // 距离3：间隔两个块的下游块
  .focus-block + .blur-block + .blur-block + .p,
  .focus-block + .blur-block + .blur-block + [data-type="NodeHeading"],
  .focus-block + .blur-block + .blur-block + .protyle-action,
  .focus-block + .blur-block + .blur-block + [data-type="NodeList"] {
      opacity: map.get($opacity-levels, 3) !important;
  }

  // ========================

  // ========================
  // 默认透明度规则
  // ========================
  .blur-block {
    opacity: 0.2;
  }
  [data-type="NodeList"] .p {
    .blur-block {
        opacity: 0.3;
    }
  }
}